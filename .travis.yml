language: java
git:
   depth: 3
jobs:
   include:
   -  stage: build
      os: linux
      jdk: oraclejdk8
      dist: trusty
   -  os: linux
      jdk: oraclejdk11
      env: DEPLOY=true
   -  os: linux
      jdk: oraclejdk11
      addons:
         apt:
            packages: mingw-w64
      env:
      - DEPLOY=true
      - OPTIONS="-Pi686-w64-mingw32 -pl -ipasir-picosat"
   -  os: linux
      jdk: oraclejdk11
      addons:
         apt:
            packages: mingw-w64
      env:
      - DEPLOY=true
      - OPTIONS="-Px86_64-w64-mingw32 -pl -ipasir-picosat"
   -  os: osx
      jdk: oraclejdk11
      env: DEPLOY=true
   -  os: linux
      jdk: oraclejdk13
   -  stage: trigger downstream
      if: (NOT type IN (pull_request)) AND (branch = master)
      before_install: skip
      install: skip
      script:
      - echo "TRAVIS_BRANCH=$TRAVIS_BRANCH TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST"
      - >
         curl -LO --retry 3 https://raw.github.com/liveontologies/trigger-travis/master/trigger-travis.sh 
         && sh trigger-travis.sh --pro liveontologies ipasir4j $TRAVIS_ACCESS_TOKEN
      after_success: skip
cache:
   directories:
   - $HOME/.m2
before_install: mkdir -p ~/.m2 && cp .settings.xml ~/.m2/settings.xml
install: mvn install -DskipTests=true -U $OPTIONS
script: mvn test -Dassembly.skipAssembly=true -B $OPTIONS
after_success:
- test "$DEPLOY" = true -a "$TRAVIS_PULL_REQUEST" = false && mvn source:jar deploy -DskipTests=true -B $OPTIONS